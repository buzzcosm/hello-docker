# ######################
# IMAGE-SIZE: ????? MB #
# ######################
# docker buildx build --platform linux/amd64 -f Dockerfile3 -t hello-docker:latest .
# FROM ghcr.io/graalvm/native-image-community:21-muslib AS build

# --- STAGE 1: Build image ---
FROM ghcr.io/graalvm/native-image-community:21-muslib AS build

WORKDIR /build

COPY mvnw .
COPY .mvn/ .mvn/
COPY pom.xml .
RUN ./mvnw dependency:go-offline

COPY src/ src/
RUN ./mvnw native:compile -Pnative -DskipTests

# --- STAGE 2: Final minimal image ---
FROM eclipse-temurin:21-jre
WORKDIR /app
EXPOSE 8080
COPY --from=build /build/target/hello-docker /app/hello-docker
ENTRYPOINT ["/app/hello-docker"]